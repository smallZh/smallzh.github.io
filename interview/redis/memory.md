## 内存相关
---
## 1 MySQL里有2000w数据，redis中只存20w的数据，如何保证redis中的数据都是热点数据? ⭐⭐ :id=hot-key
redis内存数据集大小上升到一定大小的时候，就会施行数据淘汰策略。

## 2 Redis的内存淘汰策略有哪些? ⭐⭐⭐ :id=hot-key-del
Redis的内存淘汰策略是指在Redis的用于缓存的内存不足时，怎么处理需要新写入且需要申请额外空间的数据。

**全局的键空间选择性移除**
1. noeviction：当内存不足以容纳新写入数据时，新写入操作会报错。
1. allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的key。（这个是最常用的）
1. allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个key。

**设置过期时间的键空间选择性移除**

1. volatile-lru：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的key。
1. volatile-random：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个key。
1. volatile-ttl：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，有更早过期时间的key优先移除。

**总结**

Redis的内存淘汰策略的选取并不会影响过期的key的处理。内存淘汰策略用于处理内存不足时的需要申请额外空间的数据；过期策略用于处理过期的缓存数据。

## 3 Redis主要消耗什么物理资源？⭐ :id=redis-res
内存

## 4 Redis的内存用完了会发生什么？⭐⭐⭐ :id=redis-mem-end
如果达到设置的上限，Redis的写命令会返回错误信息（但是读命令还可以正常返回。）或者你可以配置内存淘汰机制，当Redis达到内存上限时会冲刷掉旧的内容。

## 5 Redis如何做内存优化？⭐⭐⭐ :id=redis-mem-opt
1. 可以好好利用Hash,list,sorted set,set等集合类型数据，因为通常情况下很多小的Key-Value可以用更紧凑的方式存放到一起。
2. 尽可能使用散列表（hashes），散列表（是说散列表里面存储的数少）使用的内存非常小，所以你应该尽可能的将你的数据模型抽象到一个散列表里面。比如你的web系统中有一个用户对象，不要为这个用户的名称，姓氏，邮箱，密码设置单独的key，而是应该把这个用户的所有信息存储到一张散列表里面

## 6 Redis线程模型? ⭐⭐⭐⭐ :id=redis-thread
Redis基于Reactor模式开发了网络事件处理器，这个处理器被称为**文件事件处理器（file event handler）**。

它的组成结构为4部分：
1. 多个套接字
2. IO多路复用程序
3. 文件事件派发器
4. 事件处理器

因为文件事件派发器队列的消费是单线程的，所以Redis才叫单线程模型。

1. 文件事件处理器使用 I/O 多路复用（multiplexing）程序来同时监听多个套接字， 并根据套接字目前执行的任务来为套接字关联不同的事件处理器。
1. 当被监听的套接字准备好执行连接应答（accept）、读取（read）、写入（write）、关闭（close）等操作时， 与操作相对应的文件事件就会产生， 这时文件事件处理器就会调用套接字之前关联好的事件处理器来处理这些事件。

虽然文件事件处理器以单线程方式运行， 但通过使用 I/O 多路复用程序来监听多个套接字， 文件事件处理器既实现了高性能的网络通信模型， 又可以很好地与 redis 服务器中其他同样以单线程方式运行的模块进行对接， 这保持了 Redis 内部单线程设计的简单性。